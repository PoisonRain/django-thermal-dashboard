{% extends 'chat/base.html' %}

{% load staticfiles %}

{% block page_title_block %}Gravio{% endblock %}
{% block header_color_block %}light-blue{% endblock %}
{% block header_title_block %}Gravio{% endblock %}
{% block footer_color_block %}light-blue{% endblock %}
{% block footer_title_block %}Gravio{% endblock %}
{% block icon_background_block %}white{% endblock %}

{% block icon_block %}{% static 'gamio/sprites/paperairplane.png' %}{% endblock %}
{% block favicon_block %}{% static 'gamio/sprites/paperairplane.png' %}{% endblock %}
{% block icon_size_percentage_block %}6{% endblock %}

{% block body_block %} 
<br/>
<div class='container' style='margin-top=150px;'>
	<div class='row'>
		<div class='card hoverable white' id='game-container'></div>
	</div>
</div>
<script src="{% static 'gamio/pixi.js/bin/pixi.min.js' %}"></script>
<script type='text/javascript'>

var KEYLEFT = 65;
var KEYRIGHT = 68;
var KEYUP = 87;
var KEYDOWN = 83;

var KEYLEFTDOWN = false;
var KEYRIGHTDOWN = false;
var KEYUPDOWN = false;
var KEYDOWNDOWN = false;

document.addEventListener('keydown', onKeyDown);
document.addEventListener('keyup', onKeyUp);
function onKeyDown(key) {
	switch(key.keyCode) {
		case KEYLEFT:
			KEYLEFTDOWN = true;
			break;
		case KEYRIGHT:
			KEYRIGHTDOWN = true;
			break;
		case KEYUP:
			KEYUPDOWN = true;
			break;
		case KEYDOWN:
			KEYDOWNDOWN = true;
			break;
		default:
			console.log("defaulted");
			break;
	}
}
function onKeyUp(key) {
	switch(key.keyCode) {
		case KEYLEFT:
			KEYLEFTDOWN = false;
			break;
		case KEYRIGHT:
			KEYRIGHTDOWN = false;
			break;
		case KEYUP:
			KEYUPDOWN = false;
			break;
		case KEYDOWN:
			KEYDOWNDOWN = false;
			break;
		default:
			console.log("defaulted");
			break;
	}
}

// You can use either `new PIXI.WebGLRenderer`, `new PIXI.CanvasRenderer`, or `PIXI.autoDetectRenderer`
// which will try to choose the best renderer for the environment you are in.
var canvasMultiplier = 1.35;
var canvasHeight = 600 * canvasMultiplier;
var canvasWidth = 890 * canvasMultiplier;
var renderer = new PIXI.WebGLRenderer(canvasWidth, canvasHeight);
renderer.backgroundColor = 0xFFFFFF;

$("#game-container").append(renderer.view);

// You need to create a root container that will hold the scene you want to draw.
var stage = new PIXI.Container();

// Declare a global variable for our sprite so that the animate function can access it.
var plane = null;
var cloud = null;

PIXI.loader.add('cloud', '{% static 'gamio/sprites/cloud.png' %}').load(function(loader, resources) {
	cloud = new PIXI.Sprite(resources.cloud.texture);

	cloud.position.x = 0;
	cloud.position.y = Math.random() * (canvasHeight-100) - 100;
	console.log(cloud.position.y);

	cloud.scale.x = .5;
	cloud.scale.y = .5;

	stage.addChild(cloud);
	animateCloud();
});

function animateCloud() {
	requestAnimationFrame(animateCloud);
	cloud.position.x += 2;
	if(cloud.position.x > canvasWidth) {
		cloud.position.x = -200;
		cloud.position.y = Math.random() * (canvasHeight-100) - 100;
		var newscale = Math.random() * (1-.3)+.3;
		cloud.scale.x = newscale;
		cloud.scale.y = newscale;
		
		console.log(cloud.position.y);
	}
	renderer.render(stage);
}

PIXI.loader.add('plane', '{% static 'gamio/sprites/paperairplane.png' %}').load(function (loader, resources) {
	plane = new PIXI.Sprite(resources.plane.texture);

	plane.position.x = canvasWidth/2;
	plane.position.y = canvasHeight/2;

	plane.scale.x = .3;
	plane.scale.y = .3;

	plane.anchor.x = .5
	plane.anchor.y = .5
	
	stage.addChild(plane);
	animatePlane();
});

function animatePlane() {
	requestAnimationFrame(animatePlane);
	if(KEYLEFTDOWN) { 
		plane.rotation -= 0.01;
	}
	if(KEYRIGHTDOWN) {
		plane.rotation += 0.01;
	}
	plane.scale.x = plane.scale.x*.9995;
	plane.scale.y = plane.scale.y*.9995;

	var speed = 1;
	console.log(plane.rotation);
	plane.position.x = plane.position.x + speed * Math.cos(plane.rotation - 3.14/2);
	plane.position.y = plane.position.y + speed * Math.sin(plane.rotation - 3.14/2);

	renderer.render(stage);
}
</script>
{% endblock %}
